<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restro Manager</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 448 512%22><path fill=%22%234a90e2%22 d=%22M416 0C400 0 288 32 288 32V144H160V32S48 0 32 0A32 32 0 0 0 0 32v96c0 17.7 14.3 32 32 32h96v320c0 17.7 14.3 32 32 32h128c17.7 0 32-14.3 32-32V192h96c17.7 0 32-14.3 32-32V32a32 32 0 0 0-32-32z%22/></svg>">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        :root {
            --primary-color: #4a90e2;
            --dark-color: #2c3e50;
            --light-color: #f4f6f9;
            --white-color: #ffffff;
            --grey-color: #bdc3c7;
            --green-color: #27ae60;
            --red-color: #c0392b;
            --orange-color: #f39c12;
            --blue-grey: #7f8c8d;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --border-color: #e0e4e8;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--light-color); color: var(--dark-color); display: flex; height: 100vh; overflow: hidden; }
        .container { display: flex; width: 100%; }
        .sidebar { width: 260px; background: var(--dark-color); color: var(--white-color); display: flex; flex-direction: column; flex-shrink: 0; transition: width 0.3s ease; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #34495e; }
        .sidebar-header h2 { white-space: nowrap; overflow: hidden; }
        .sidebar-header h2 i { margin-right: 10px; }
        .sidebar-menu { list-style: none; flex-grow: 1; margin-top: 10px; }
        .sidebar-menu li a { display: flex; align-items: center; padding: 18px 25px; color: var(--light-color); text-decoration: none; transition: background 0.3s ease, color 0.3s ease; white-space: nowrap; }
        .sidebar-menu li a i { margin-right: 15px; font-size: 1.1em; width: 20px; text-align: center; }
        .sidebar-menu li a:hover, .sidebar-menu li a.active { background: var(--primary-color); color: var(--white-color); }
        .main-content { flex-grow: 1; overflow-y: auto; }
        .main-header { padding: 25px; background: var(--white-color); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .main-header h1 { font-weight: 600; font-size: 1.8rem; }
        .page-content { padding: 25px; }
        .page-section { display: none; animation: fadeIn 0.5s ease-in-out; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .dashboard-overview { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .stat-card { background: var(--white-color); padding: 25px; border-radius: 12px; box-shadow: var(--shadow); display: flex; align-items: center; transition: transform 0.3s, box-shadow 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .stat-card i { font-size: 2.2em; margin-right: 20px; }
        .stat-card .icon-blue { color: var(--primary-color); } .stat-card .icon-red { color: var(--red-color); } .stat-card .icon-green { color: var(--green-color); } .stat-card .icon-orange { color: var(--orange-color); }
        .stat-info p { font-size: 0.9em; color: var(--blue-grey); } .stat-info h3 { font-size: 1.8em; font-weight: 600; }
        .content-box { background: var(--white-color); padding: 25px; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 30px; }
        .content-box-header { font-weight: 600; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .content-box-header .header-actions { display: flex; gap: 10px; } .content-box-header i { margin-right: 10px; }
        .table-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 20px; margin-bottom: 15px; }
        .table-box { height: 100px; border: 2px solid; border-radius: 8px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s ease; font-weight: 600; }
        .table-box:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
        .table-box.vacant { border-color: var(--green-color); background: #e8f8f5; color: var(--green-color); }
        .table-box.occupied { border-color: var(--red-color); background: var(--red-color); color: var(--white-color); }
        .table-box.reserved { border-color: var(--orange-color); background: #fef5e7; color: var(--orange-color); }
        .legend { display: flex; gap: 20px; font-size: 0.9em; justify-content: flex-end; flex-wrap: wrap; }
        .legend .color-box { display: inline-block; width: 15px; height: 15px; margin-right: 8px; vertical-align: middle; border-radius: 3px; }
        .legend .vacant { background: #e8f8f5; border: 1px solid var(--green-color); } .legend .occupied { background: var(--red-color); } .legend .reserved { background: #fef5e7; border: 1px solid var(--orange-color); }
        .menu-management-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; }
        .desktop-table-container { overflow-x: auto; }
        .desktop-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .desktop-table th, .desktop-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); white-space: nowrap; }
        .desktop-table thead th { background-color: #f9fafb; font-weight: 600; }
        .desktop-table tbody tr:hover { background-color: #f9fafb; }
        .form-container form { display: flex; flex-direction: column; gap: 15px; }
        .form-actions { display: flex; gap: 10px; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--grey-color); border-radius: 5px; font-family: 'Poppins', sans-serif; font-size: 0.95rem; }
        button, .btn { background: var(--primary-color); color: var(--white-color); border: none; padding: 12px 15px; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 8px; flex-grow: 1;}
        button:hover, .btn:hover { background: #3a7bc8; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn-secondary { background: var(--blue-grey); }
        .btn-secondary:hover { background: var(--dark-color); }
        .action-btn { background: none; border: none; cursor: pointer; font-size: 1rem; padding: 8px; transition: color 0.2s; font-weight: 500;}
        .action-btn.edit { color: var(--primary-color); } .action-btn.edit:hover { color: #3a7bc8; }
        .action-btn.delete { color: var(--red-color); } .action-btn.delete:hover { color: #a5281e; }
        .action-btn.confirm { color: var(--green-color); } .action-btn.confirm:hover { color: #1e8449; }
        .action-btn.cancel { color: var(--blue-grey); } .action-btn.cancel:hover { color: var(--dark-color); }
        .status-badge { padding: 5px 12px; border-radius: 15px; font-size: 0.8em; font-weight: 600; color: var(--white-color); text-transform: uppercase; letter-spacing: 0.5px; }
        .status-confirmed { background: var(--green-color); } .status-pending { background: var(--orange-color); } .status-cancelled { background: var(--red-color); }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .chart-container { position: relative; min-height: 350px; width: 100%; }
        .filter-controls { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }

        .mobile-card-view { display: none; }
        .mobile-card { background: var(--white-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: var(--shadow); }
        .mobile-card-header { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .mobile-card-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; font-size: 0.9rem; }
        .mobile-card-label { color: var(--blue-grey); font-weight: 500; }
        .mobile-card-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); }
        .mobile-card-actions .action-btn { flex-grow: 0; }

        @media (max-width: 992px) {
            .sidebar { width: 78px; }
            .sidebar .link-text, .sidebar .sidebar-header .link-text { display: none; }
            .sidebar-header h2 i { margin-right: 0; }
            .sidebar-menu li a { justify-content: center; }
            .header-actions .btn-text, #export-sales-btn .btn-text { display: none; }
        }

        @media (max-width: 768px) {
            .page-content { padding: 15px; } .content-box { padding: 15px; }
            .main-header h1 { font-size: 1.5rem; }
            .stat-card { padding: 15px; flex-direction: column; text-align: center; }
            .stat-card i { margin-right: 0; margin-bottom: 10px; }
            .menu-management-grid, .dashboard-grid { grid-template-columns: 1fr; }
            .desktop-table-container { display: none; }
            .mobile-card-view { display: block; }
            .legend { justify-content: flex-start; align-items: flex-start; flex-direction: column; gap: 10px; margin-top: 20px; }
        }
        @media (max-width: 400px) {
            .page-content, .content-box { padding: 10px; }
            .main-header h1 { font-size: 1.3rem; }
            .stat-info h3 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header"><h2><i class="fas fa-utensils"></i> <span class="link-text">Restro POS</span></h2></div>
            <ul class="sidebar-menu">
                <li><a href="#" data-target="dashboard" class="active" title="Dashboard"><i class="fas fa-tachometer-alt"></i> <span class="link-text">Dashboard</span></a></li>
                <li><a href="#" data-target="tables" title="Table Management"><i class="fas fa-chair"></i> <span class="link-text">Table Management</span></a></li>
                <li><a href="#" data-target="bookings" title="Bookings"><i class="fas fa-calendar-check"></i> <span class="link-text">Bookings</span></a></li>
                <li><a href="#" data-target="menu" title="Menu Master"><i class="fas fa-book-open"></i> <span class="link-text">Menu Master</span></a></li>
                <li><a href="#" data-target="sales" title="Sales Admin"><i class="fas fa-chart-line"></i> <span class="link-text">Sales Admin</span></a></li>
            </ul>
        </aside>

        <main class="main-content">
            <header class="main-header"><h1 id="page-title">Dashboard</h1></header>
            <div class="page-content">
                
                <section id="dashboard" class="page-section active">
                    <div class="dashboard-overview">
                        <div class="stat-card"><i class="fas fa-calendar-check icon-blue"></i><div class="stat-info"><p>Pending Bookings</p><h3 id="stat-pending-bookings">0</h3></div></div>
                        <div class="stat-card"><i class="fas fa-chair icon-red"></i><div class="stat-info"><p>Occupied Tables</p><h3 id="stat-occupied-tables">0</h3></div></div>
                        <div class="stat-card"><i class="fas fa-utensils icon-green"></i><div class="stat-info"><p>Total Menu Items</p><h3 id="stat-menu-items">0</h3></div></div>
                        <div class="stat-card"><i class="fas fa-users icon-orange"></i><div class="stat-info"><p>Guests Expected Today</p><h3 id="stat-total-guests">0</h3></div></div>
                    </div>
                     <div class="dashboard-grid">
                        <div class="content-box">
                            <h2 class="content-box-header"><i class="fas fa-chart-pie"></i> Sales Overview</h2>
                            <div class="chart-container"><canvas id="salesPieChart"></canvas></div>
                        </div>
                        <div class="content-box">
                            <h2 class="content-box-header"><i class="fas fa-calendar-alt"></i> Today's Upcoming Bookings</h2>
                            <div class="mobile-card-view" id="dashboard-bookings-cards"></div>
                        </div>
                    </div>
                </section>

                <section id="tables" class="page-section">
                    <div class="content-box">
                         <h2 class="content-box-header"><span><i class="fas fa-chair"></i> Live Table Status</span></h2>
                         <div class="table-layout" id="table-layout"></div>
                         <div class="legend"><div><span class="color-box vacant"></span> Vacant</div><div><span class="color-box occupied"></span> Occupied</div><div><span class="color-box reserved"></span> Reserved</div></div>
                    </div>
                </section>

                <section id="bookings" class="page-section">
                     <div class="content-box">
                         <h2 class="content-box-header"><span><i class="fas fa-calendar-check"></i> All Bookings</span></h2>
                         <div class="desktop-table-container"><table class="desktop-table"><thead><tr><th>Customer Name</th><th>Phone</th><th>Date & Time</th><th>Guests</th><th>Status</th><th>Action</th></tr></thead><tbody id="bookings-table-body"></tbody></table></div>
                         <div class="mobile-card-view" id="bookings-card-container"></div>
                     </div>
                </section>

                <section id="menu" class="page-section">
                    <div class="content-box">
                        <div class="content-box-header">
                            <span><i class="fas fa-book-open"></i> Menu Master</span>
                            <div class="header-actions">
                                <button id="import-menu-btn" class="btn btn-secondary" title="Import from Excel"><i class="fas fa-file-import"></i> <span class="btn-text">Import</span></button>
                                <button id="export-menu-btn" class="btn btn-secondary" title="Export to Excel"><i class="fas fa-file-export"></i> <span class="btn-text">Export</span></button>
                                <input type="file" id="menu-file-input" style="display: none;" accept=".xlsx, .xls">
                            </div>
                        </div>
                        <div class="menu-management-grid">
                            <div>
                                <div class="desktop-table-container"><table class="desktop-table"><thead><tr><th>Item Name</th><th>Category</th><th>Price</th><th>Action</th></tr></thead><tbody id="menu-items-table-body"></tbody></table></div>
                                <div class="mobile-card-view" id="menu-items-card-container"></div>
                            </div>
                            <div class="form-container">
                                <h3 id="menu-form-title">Add New Item</h3>
                                <form id="add-menu-form">
                                    <input type="text" id="item-name" placeholder="Item Name" required>
                                    <input type="text" id="item-category" placeholder="Category (e.g., Starter)" required>
                                    <input type="number" id="item-price" placeholder="Price" step="any" min="0" required>
                                    <div class="form-actions"><button type="submit" id="menu-form-submit-btn"><i class="fas fa-plus"></i>Add Item</button><button type="button" id="menu-form-cancel-btn" class="btn btn-secondary" style="display: none;"><i class="fas fa-times"></i>Cancel</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="sales" class="page-section">
                    <div class="content-box">
                        <div class="content-box-header">
                            <div><i class="fas fa-file-invoice-dollar"></i> Sales Report</div>
                            <button id="export-sales-btn" class="btn"><i class="fas fa-file-excel"></i> <span class="btn-text">Export to Excel</span></button>
                        </div>
                        <div class="filter-controls"><label for="sales-period-filter">Filter by:</label><select id="sales-period-filter"><option value="day">Today</option><option value="week">This Week</option><option value="month">This Month</option></select></div>
                         <div class="desktop-table-container"><table class="desktop-table"><thead><tr><th>Order ID</th><th>Date</th><th>Item</th><th>Category</th><th>Price</th></tr></thead><tbody id="sales-table-body"></tbody></table></div>
                         <div class="mobile-card-view" id="sales-card-container"></div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            let tablesData = [{ id: 't1', name: 'Table 1', capacity: 4, status: 'vacant' }, { id: 't2', name: 'Table 2', capacity: 2, status: 'occupied' },{ id: 't3', name: 'Table 3', capacity: 6, status: 'vacant' }, { id: 't4', name: 'Table 4', capacity: 4, status: 'reserved' },];
            let menuItemsData = [{ name: 'Paneer Tikka', category: 'Starter', price: 250 }, { name: 'Dal Makhani', category: 'Main Course', price: 350 }, { name: 'Garlic Naan', category: 'Breads', price: 60 }, { name: 'Gulab Jamun', category: 'Dessert', price: 120 },];
            let bookingsData = [{ id: 1, customerName: 'Rohan Sharma', phone: '9876543210', date: '2025-08-11', time: '19:30', guests: 4, status: 'Confirmed' },{ id: 2, customerName: 'Priya Singh', phone: '8765432109', date: '2025-08-11', time: '20:00', guests: 2, status: 'Pending' },{ id: 3, customerName: 'Amit Patel', phone: '7654321098', date: '2025-08-12', time: '21:00', guests: 5, status: 'Pending' },];
            let salesData = [{ orderId: 1, date: '2025-08-11', item: 'Paneer Tikka', category: 'Starter', price: 250 },{ orderId: 2, date: '2025-08-10', item: 'Garlic Naan', category: 'Breads', price: 60 },];

            const pageTitle = document.getElementById('page-title');
            const navLinks = document.querySelectorAll('.sidebar-menu a');
            const pageSections = document.querySelectorAll('.page-section');
            const tableLayout = document.getElementById('table-layout');
            const menuItemsTableBody = document.getElementById('menu-items-table-body');
            const menuItemsCardContainer = document.getElementById('menu-items-card-container');
            const bookingsTableBody = document.getElementById('bookings-table-body');
            const bookingsCardContainer = document.getElementById('bookings-card-container');
            const dashboardBookingsCards = document.getElementById('dashboard-bookings-cards');
            const addMenuForm = document.getElementById('add-menu-form');
            const salesTableBody = document.getElementById('sales-table-body');
            const salesCardContainer = document.getElementById('sales-card-container');
            const salesPeriodFilter = document.getElementById('sales-period-filter');
            const exportSalesBtn = document.getElementById('export-sales-btn');
            const importMenuBtn = document.getElementById('import-menu-btn');
            const exportMenuBtn = document.getElementById('export-menu-btn');
            const menuFileInput = document.getElementById('menu-file-input');
            const menuFormTitle = document.getElementById('menu-form-title');
            const menuFormSubmitBtn = document.getElementById('menu-form-submit-btn');
            const menuFormCancelBtn = document.getElementById('menu-form-cancel-btn');
            let editingMenuIndex = null;
            let salesChart;

            const renderTables = () => { if (tableLayout) { tableLayout.innerHTML = ''; tablesData.forEach(table => { const tableBox = document.createElement('div'); tableBox.className = `table-box ${table.status}`; tableBox.dataset.id = table.id; tableBox.innerHTML = `<div class="table-name">${table.name}</div><div class="table-capacity">${table.capacity} Persons</div>`; tableLayout.appendChild(tableBox); }); } };
            
            const renderMenuItems = () => {
                if (menuItemsTableBody) menuItemsTableBody.innerHTML = '';
                if (menuItemsCardContainer) menuItemsCardContainer.innerHTML = '';
                menuItemsData.forEach((item, index) => {
                    const tableRow = document.createElement('tr');
                    tableRow.innerHTML = `<td>${item.name}</td><td>${item.category}</td><td>₹${item.price.toFixed(2)}</td><td class="actions"><button class="action-btn edit" data-index="${index}" title="Edit Item"><i class="fas fa-edit"></i></button><button class="action-btn delete" data-index="${index}" title="Delete Item"><i class="fas fa-trash-alt"></i></button></td>`;
                    if (menuItemsTableBody) menuItemsTableBody.appendChild(tableRow);
                    
                    const card = document.createElement('div');
                    card.className = 'mobile-card';
                    card.innerHTML = `<div class="mobile-card-header">${item.name}</div><div class="mobile-card-row"><span class="mobile-card-label">Category</span> ${item.category}</div><div class="mobile-card-row"><span class="mobile-card-label">Price</span> ₹${item.price.toFixed(2)}</div><div class="mobile-card-actions"><button class="action-btn edit" data-index="${index}" title="Edit Item"><i class="fas fa-edit"></i> Edit</button><button class="action-btn delete" data-index="${index}" title="Delete Item"><i class="fas fa-trash-alt"></i> Delete</button></div>`;
                    if (menuItemsCardContainer) menuItemsCardContainer.appendChild(card);
                });
            };

            const renderBookings = () => {
                if (bookingsTableBody) bookingsTableBody.innerHTML = '';
                if (bookingsCardContainer) bookingsCardContainer.innerHTML = '';
                if (dashboardBookingsCards) dashboardBookingsCards.innerHTML = '';
                
                const today = new Date().toISOString().slice(0, 10);
                bookingsData.sort((a, b) => new Date(`${a.date} ${a.time}`) - new Date(`${b.date} ${b.time}`));
                
                bookingsData.forEach(booking => {
                    const statusClass = `status-${booking.status.toLowerCase()}`;
                    const actionsHtml = `${booking.status === 'Pending' ? `<button class="action-btn confirm" data-id="${booking.id}" title="Confirm"><i class="fas fa-check-circle"></i> Confirm</button>` : ''}${booking.status !== 'Cancelled' ? `<button class="action-btn cancel" data-id="${booking.id}" title="Cancel"><i class="fas fa-times-circle"></i> Cancel</button>` : ''}`;
                    
                    const allBookingsRowHtml = `<td>${booking.customerName}</td> <td>${booking.phone}</td> <td>${booking.date} @ ${booking.time}</td><td>${booking.guests}</td> <td><span class="status-badge ${statusClass}">${booking.status}</span></td><td>${actionsHtml.replace(/<i[^>]*><\/i>/g, "").replace(/ Confirm/g,"").replace(/ Cancel/g,"")}</td>`;
                    if(bookingsTableBody) bookingsTableBody.innerHTML += `<tr>${allBookingsRowHtml}</tr>`;

                    const card = document.createElement('div');
                    card.className = 'mobile-card';
                    card.innerHTML = `<div class="mobile-card-header">${booking.customerName}</div><div class="mobile-card-row"><span class="mobile-card-label">Phone</span> ${booking.phone}</div><div class="mobile-card-row"><span class="mobile-card-label">Date & Time</span> ${booking.date} @ ${booking.time}</div><div class="mobile-card-row"><span class="mobile-card-label">Guests</span> ${booking.guests}</div><div class="mobile-card-row"><span class="mobile-card-label">Status</span> <span class="status-badge ${statusClass}">${booking.status}</span></div><div class="mobile-card-actions">${actionsHtml}</div>`;
                    if(bookingsCardContainer) bookingsCardContainer.appendChild(card);

                    if (booking.date === today && booking.status !== 'Cancelled') {
                        const dashboardCard = document.createElement('div');
                        dashboardCard.className = 'mobile-card';
                        dashboardCard.innerHTML = `<div class="mobile-card-header">${booking.customerName}</div><div class="mobile-card-row"><span class="mobile-card-label">Time</span> ${booking.time}</div><div class="mobile-card-row"><span class="mobile-card-label">Guests</span> ${booking.guests}</div><div class="mobile-card-row"><span class="mobile-card-label">Status</span> <span class="status-badge ${statusClass}">${booking.status}</span></div>`;
                        if(dashboardBookingsCards) dashboardBookingsCards.appendChild(dashboardCard);
                    }
                });
            };

            const renderSalesPieChart = () => { const ctx = document.getElementById('salesPieChart').getContext('2d'); const salesByCategory = salesData.reduce((acc, sale) => { acc[sale.category] = (acc[sale.category] || 0) + sale.price; return acc; }, {}); if (salesChart) { salesChart.destroy(); } const isMobile = window.innerWidth <= 768; salesChart = new Chart(ctx, { type: 'pie', data: { labels: Object.keys(salesByCategory), datasets: [{ label: 'Sales by Category', data: Object.values(salesByCategory), backgroundColor: ['#4a90e2', '#27ae60', '#f39c12', '#c0392b', '#7f8c8d', '#8e44ad'], borderColor: '#ffffff', borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: isMobile ? 10 : 12 }, padding: 15 } } } } }); };
            const filterSalesData = (period) => { const now = new Date(); const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); let startDate; switch (period) { case 'day': startDate = today; break; case 'week': startDate = new Date(today); startDate.setDate(startDate.getDate() - now.getDay()); break; case 'month': startDate = new Date(now.getFullYear(), now.getMonth(), 1); break; } return salesData.filter(sale => new Date(sale.date) >= startDate); };
            const renderSalesTable = () => { if (salesTableBody) salesTableBody.innerHTML = ''; if(salesCardContainer) salesCardContainer.innerHTML = ''; const period = salesPeriodFilter.value; const filteredData = filterSalesData(period); filteredData.forEach(sale => { const rowHtml = `<td>${sale.orderId}</td><td>${sale.date}</td><td>${sale.item}</td><td>${sale.category}</td><td>₹${sale.price.toFixed(2)}</td>`; if(salesTableBody) salesTableBody.innerHTML += `<tr>${rowHtml}</tr>`; const cardHtml = `<div class="mobile-card"><div class="mobile-card-header">${sale.item}</div><div class="mobile-card-row"><span class="mobile-card-label">Order ID</span> #${sale.orderId}</div><div class="mobile-card-row"><span class="mobile-card-label">Date</span> ${sale.date}</div><div class="mobile-card-row"><span class="mobile-card-label">Category</span> ${sale.category}</div><div class="mobile-card-row"><span class="mobile-card-label">Price</span> ₹${sale.price.toFixed(2)}</div></div>`; if(salesCardContainer) salesCardContainer.innerHTML += cardHtml; }); };
            const updateDashboardStats = () => { document.getElementById('stat-pending-bookings').textContent = bookingsData.filter(b => b.status === 'Pending').length; document.getElementById('stat-occupied-tables').textContent = tablesData.filter(t => t.status === 'occupied').length; document.getElementById('stat-menu-items').textContent = menuItemsData.length; const today = new Date().toISOString().slice(0, 10); document.getElementById('stat-total-guests').textContent = bookingsData.filter(b => b.date === today && b.status === 'Confirmed').reduce((sum, b) => sum + b.guests, 0); };
            const switchPage = (targetId) => { navLinks.forEach(link => { link.classList.toggle('active', link.dataset.target === targetId); }); pageSections.forEach(section => { section.classList.toggle('active', section.id === targetId); }); const activeLink = document.querySelector(`.sidebar-menu a[data-target="${targetId}"]`); pageTitle.textContent = activeLink.title; if (targetId === 'dashboard') { setTimeout(renderSalesPieChart, 50); } };
            const resetMenuForm = () => { addMenuForm.reset(); menuFormTitle.textContent = "Add New Item"; menuFormSubmitBtn.innerHTML = '<i class="fas fa-plus"></i>Add Item'; menuFormCancelBtn.style.display = 'none'; editingMenuIndex = null; };
            
            navLinks.forEach(link => { link.addEventListener('click', e => { e.preventDefault(); switchPage(e.currentTarget.dataset.target); }); });
            if (tableLayout) { tableLayout.addEventListener('click', e => { const tableBox = e.target.closest('.table-box'); if (tableBox) { const table = tablesData.find(t => t.id === tableBox.dataset.id); if (table && table.status !== 'reserved') { table.status = (table.status === 'vacant') ? 'occupied' : 'vacant'; renderTables(); updateDashboardStats(); } } }); }
            if (addMenuForm) { addMenuForm.addEventListener('submit', e => { e.preventDefault(); const name = document.getElementById('item-name').value.trim(); const category = document.getElementById('item-category').value.trim(); const price = parseFloat(document.getElementById('item-price').value); const newItem = { name, category, price }; if (editingMenuIndex !== null) { menuItemsData[editingMenuIndex] = newItem; } else { menuItemsData.push(newItem); } renderMenuItems(); updateDashboardStats(); resetMenuForm(); }); }
            if (menuFormCancelBtn) { menuFormCancelBtn.addEventListener('click', resetMenuForm); }
            
            const handleMenuAction = (e) => {
                const btn = e.target.closest('.action-btn'); if (!btn) return;
                const index = btn.dataset.index;
                if (btn.classList.contains('delete')) { if (confirm('Are you sure you want to delete this menu item?')) { menuItemsData.splice(index, 1); renderMenuItems(); updateDashboardStats(); if (editingMenuIndex == index) resetMenuForm(); } } 
                else if (btn.classList.contains('edit')) { const item = menuItemsData[index]; document.getElementById('item-name').value = item.name; document.getElementById('item-category').value = item.category; document.getElementById('item-price').value = item.price; menuFormTitle.textContent = "Edit Item"; menuFormSubmitBtn.innerHTML = '<i class="fas fa-save"></i>Update Item'; menuFormCancelBtn.style.display = 'inline-flex'; editingMenuIndex = index; document.getElementById('item-name').focus(); }
            };
            if (menuItemsTableBody) menuItemsTableBody.addEventListener('click', handleMenuAction);
            if (menuItemsCardContainer) menuItemsCardContainer.addEventListener('click', handleMenuAction);
            
            const handleBookingAction = (e) => {
                const btn = e.target.closest('.action-btn'); if (!btn) return;
                const booking = bookingsData.find(b => b.id == btn.dataset.id);
                if(btn.classList.contains('confirm')) booking.status = 'Confirmed';
                if(btn.classList.contains('cancel')) booking.status = 'Cancelled';
                renderBookings(); updateDashboardStats();
            };
            if (bookingsTableBody) bookingsTableBody.addEventListener('click', handleBookingAction);
            if (bookingsCardContainer) bookingsCardContainer.addEventListener('click', handleBookingAction);

            if (salesPeriodFilter) { salesPeriodFilter.addEventListener('change', renderSalesTable); }
            if (exportSalesBtn) { exportSalesBtn.addEventListener('click', () => { const period = salesPeriodFilter.value; const filteredData = filterSalesData(period); const worksheet = XLSX.utils.json_to_sheet(filteredData); const workbook = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(workbook, worksheet, "SalesData"); XLSX.writeFile(workbook, `RestroManager_Sales_${period}.xlsx`); }); }
            if (importMenuBtn) { importMenuBtn.addEventListener('click', () => menuFileInput.click()); }
            if (exportMenuBtn) { exportMenuBtn.addEventListener('click', () => { const worksheet = XLSX.utils.json_to_sheet(menuItemsData); const workbook = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(workbook, worksheet, "MenuItems"); XLSX.writeFile(workbook, "RestroManager_Menu.xlsx"); }); }
            if (menuFileInput) { menuFileInput.addEventListener('change', e => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (event) => { try { const data = new Uint8Array(event.target.result); const workbook = XLSX.read(data, { type: 'array' }); const worksheet = workbook.Sheets[workbook.SheetNames[0]]; const jsonData = XLSX.utils.sheet_to_json(worksheet); let importedCount = 0, failedCount = 0; jsonData.forEach(item => { if (item.name && item.category && item.price && !isNaN(parseFloat(item.price))) { menuItemsData.push({ name: String(item.name), category: String(item.category), price: parseFloat(item.price) }); importedCount++; } else { failedCount++; } }); renderMenuItems(); updateDashboardStats(); alert(`Import complete!\nSuccessfully imported: ${importedCount} items.\nFailed or skipped: ${failedCount} items.`); } catch (error) { alert("Error reading the Excel file. Please check the format."); console.error(error); } }; reader.readAsArrayBuffer(file); menuFileInput.value = ''; } }); }

            window.addEventListener('resize', () => { if(salesChart) { renderSalesPieChart(); }});

            const initialize = () => { renderTables(); renderMenuItems(); renderBookings(); renderSalesTable(); updateDashboardStats(); switchPage('dashboard'); };
            initialize();
        });
    </script>
</body>
</html> 